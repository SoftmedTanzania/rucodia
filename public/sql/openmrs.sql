SELECT location.uuid As locationuuid, location.name AS locationname, parent.uuid AS parentuuid, village.name AS Village, COUNT(arusha.uid) as RegHHs, SUM(arusha.nets) AS Quantified, village.distributed AS Distr, COUNT(CASE WHEN arusha.status=1 THEN arusha.uid ELSE 0 END) AS MRC1HHs, Sum(Case When arusha.status = '1' Then arusha.nets Else 0 End) AS Redeemed, village.new_households as MRC3HHs, village.missed AS MRC3 INTO OUTFILE '/var/lib/mysql-files/arusha_summary.csv' FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' LINES TERMINATED BY '\n' FROM village inner join ward on village.ward_id=ward.id inner join districts on ward.district_id=districts.id inner join regions on districts.region_id=regions.id inner join arusha on village.id=arusha.village group by village.id order by regions.region, districts.district, ward.name, village.name;